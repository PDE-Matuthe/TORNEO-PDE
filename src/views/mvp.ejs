<%- include('partials/head') %>
<%- include('partials/nav') %>

<main class="max-w-7xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-8">
    <% if (typeof isTorneoEspecifico !== 'undefined' && isTorneoEspecifico) { %>
      <div class="mb-4 flex items-center gap-2">
        <a href="/torneos-anteriores" class="text-gold hover:text-yellow-400 text-sm">Torneos Anteriores</a>
        <span class="text-slate-500">/</span>
        <span class="text-slate-400 text-sm"><%= torneo.nombre %></span>
      </div>
    <% } %>
    <h1 class="text-4xl font-bold mb-2">
      <i class="fas fa-star text-gold mr-3"></i> Ranking MVP<% if (typeof isTorneoEspecifico !== 'undefined' && isTorneoEspecifico) { %> - <%= torneo.nombre %><% } %>
    </h1>
    <p class="text-slate-400">Los mejores jugadores del torneo seg√∫n su desempe√±o</p>
  </div>

  <% if (typeof ranking !== 'undefined' && ranking && ranking.length > 0) { %>
    <!-- Top 3 Podium -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      <% ranking.slice(0, 3).forEach((player, index) => { %>
        <% const medals = ['ü•á', 'ü•à', 'ü•â']; %>
        <div class="card hover:shadow-gold transition transform hover:scale-105">
          <div class="text-center">
            <!-- Medal -->
            <div class="text-5xl mb-3"><%= medals[index] %></div>
            
            <!-- Player Image / Logo -->
            <% if (player.equipo_logo) { %>
              <img src="<%= player.equipo_logo %>" 
                   alt="<%= player.equipo_nombre %>" 
                   class="h-16 w-16 rounded-full mx-auto mb-3 border-2 border-gold object-cover">
            <% } else { %>
              <div class="h-16 w-16 rounded-full mx-auto mb-3 bg-slate-700 flex items-center justify-center">
                <i class="fas fa-user text-2xl text-slate-500"></i>
              </div>
            <% } %>
            
            <!-- Name & Team -->
            <h2 class="text-2xl font-bold text-white">
              <a href="/jugador/<%= player.jugador_id %>" class="hover:text-gold transition">
                <%= player.nombre_invocador %>
              </a>
            </h2>
            <p class="text-slate-400 mb-3"><%= player.equipo_nombre %></p>
            
            <!-- KDA Ratio -->
            <div class="mvp-badge mb-4">
              <%= parseFloat(player.kda).toFixed(2) %> KDA
            </div>
            
            <!-- Stats Grid -->
            <div class="grid grid-cols-3 gap-2 text-sm">
              <div class="bg-slate-700 p-2 rounded">
                <p class="text-xs text-slate-400">K</p>
                <p class="font-bold text-green-400"><%= player.total_kills %></p>
              </div>
              <div class="bg-slate-700 p-2 rounded">
                <p class="text-xs text-slate-400">D</p>
                <p class="font-bold text-red-400"><%= player.total_deaths %></p>
              </div>
              <div class="bg-slate-700 p-2 rounded">
                <p class="text-xs text-slate-400">A</p>
                <p class="font-bold text-gold"><%= player.total_assists %></p>
              </div>
            </div>
          </div>
        </div>
      <% }); %>
    </div>

    <!-- Full Ranking Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Ranking Completo</h3>
      </div>
      
      <div class="overflow-x-auto">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 5%;">#</th>
              <th style="width: 25%;">Jugador</th>
              <th style="width: 12%;">Rol</th>
              <th style="width: 15%;">KDA Ratio</th>
              <th style="width: 18%;">K / D / A</th>
              <th style="width: 12%;">CS/min</th>
              <th style="width: 13%;">Dmg/min</th>
            </tr>
          </thead>
          <tbody>
            <% ranking.forEach((player, index) => { %>
              <tr>
                <td class="font-bold text-gold">
                  <% if (index === 0) { %>
                    <i class="fas fa-crown text-gold mr-2"></i>1
                  <% } else if (index === 1) { %>
                    <i class="fas fa-star text-silver mr-2"></i>2
                  <% } else if (index === 2) { %>
                    <i class="fas fa-gem text-bronze mr-2"></i>3
                  <% } else { %>
                    <%= index + 1 %>
                  <% } %>
                </td>
                <td>
                  <div class="flex items-center gap-2">
                    <% if (player.equipo_logo) { %>
                      <img src="<%= player.equipo_logo %>" 
                           alt="<%= player.equipo_nombre %>"
                           class="w-8 h-8 rounded-full object-cover">
                    <% } else { %>
                      <div class="w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center">
                        <i class="fas fa-user text-xs text-slate-400"></i>
                      </div>
                    <% } %>
                    <div>
                      <p class="font-bold text-white"><%= player.nombre_invocador %></p>
                      <p class="text-xs text-slate-400"><%= player.equipo_nombre %></p>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="stat-badge"><%= player.rol_juego %></span>
                </td>
                <td class="font-bold text-gold">
                  <%= parseFloat(player.kda).toFixed(2) %>
                </td>
                <td>
                  <span class="text-green-400"><%= player.total_kills %></span>
                  <span class="text-slate-500">/</span>
                  <span class="text-red-400"><%= player.total_deaths %></span>
                  <span class="text-slate-500">/</span>
                  <span class="text-gold"><%= player.total_assists %></span>
                </td>
                <td class="text-slate-300">
                  <%= parseFloat(player.avg_cs).toFixed(1) %>
                </td>
                <td class="text-slate-300">
                  <%= parseFloat(player.avg_dmg).toFixed(0) %>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  <% } else { %>
    <div class="card text-center py-12">
      <i class="fas fa-trophy text-6xl text-slate-600 mb-4"></i>
      <h2 class="text-2xl font-bold text-slate-300">No hay datos de estad√≠sticas</h2>
      <p class="text-slate-400 mt-2">Las estad√≠sticas aparecer√°n cuando se carguen partidas</p>
    </div>
  <% } %>

  <!-- Enlaces de navegaci√≥n para torneo espec√≠fico -->
  <% if (typeof isTorneoEspecifico !== 'undefined' && isTorneoEspecifico && typeof torneo !== 'undefined' && torneo) { %>
    <div class="mt-12 pt-8 border-t border-slate-700">
      <div class="flex flex-wrap gap-3 justify-center">
        <a href="/torneo/<%= torneo.id %>/calendario" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded transition flex items-center gap-2">
          <i class="fas fa-calendar"></i> Calendario
        </a>
        <a href="/torneo/<%= torneo.id %>/bracket" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded transition flex items-center gap-2">
          <i class="fas fa-sitemap"></i> Bracket
        </a>
        <a href="/torneo/<%= torneo.id %>/equipos" class="px-4 py-2 bg-pink-600 hover:bg-pink-500 text-white rounded transition flex items-center gap-2">
          <i class="fas fa-users"></i> Equipos
        </a>
        <a href="/torneos-anteriores" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition flex items-center gap-2">
          <i class="fas fa-arrow-left"></i> Volver
        </a>
      </div>
    </div>
  <% } %>
</main>

<%- include('partials/footer') %>